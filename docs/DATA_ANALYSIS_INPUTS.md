# Data Analysis Inputs

This note captures how the auto-run tooling lays out telemetry, logs, and
summary files so we can build an analysis script with the correct
assumptions. Everything below is derived from
`tools/auto/drone_follower.py` and `tools/auto/gcs_scheduler.py`.

## Directory Overview

```
output/
  drone/<session_id>/
    system_monitoring_<session_id>.csv
    packet_timing.csv
    power/...
    (additional monitor CSVs copied in later)
  gcs/
    saturation_<suite>_<session_id>.xlsx
    <session_id>_combined.xlsx
logs/auto/
  drone/
    drone_YYYYMMDD-HHMMSS.log
    <suite>/drone_status.json
    <suite>/drone_summary.json
    <suite>/perf_samples_<suite>.csv
    <suite>/psutil_proc_<suite>.csv
    <suite>/sys_telemetry_<suite>.csv
    <suite>/pidstat_<suite>.txt
  gcs/
    gcs_YYYYMMDD-HHMMSS.log
    gcs_status.json
    gcs_summary.json
    summary.csv
    suites/<suite>/blaster_events.jsonl
    suites/<suite>/saturation_<rate>Mbps.jsonl
```

`session_id` defaults to `session_<epoch>` but can be overridden via
`DRONE_SESSION_ID` / `GCS_SESSION_ID`. The drone session directory is rooted at
`AUTO_DRONE.monitor_output_base` (defaults to `output/drone`). GCS workbook
outputs live under `AUTO_GCS.GCS_EXCEL_OUTPUT` / `AUTO_GCS.GCS_COMBINED_OUTPUT_BASE`
(default `output/gcs`).

## Drone Follower Artifacts (`output/drone/<session_id>`)

### `system_monitoring_<session_id>.csv`
Produced by `HighSpeedMonitor`. Columns:

- `timestamp_iso`, `timestamp_ns`
- `suite`, `proxy_pid`
- `cpu_percent`, `cpu_freq_mhz`, `cpu_temp_c`
- `mem_used_mb`, `mem_percent`
- `rekey_duration_ms` (blank unless rekey in flight)

A fresh sample lands every 100 ms. Each write flushes to disk, so the file is
safe to tail while runs are active.

### `packet_timing.csv`
Written by the UDP echo loop for approximately every 100th packet. Columns:

- `recv_timestamp_ns`, `send_timestamp_ns`
- `processing_ns`, `processing_ms`
- `sequence`

### Power capture outputs (`power/`)
`PowerCaptureManager` delegates to `core.power_monitor.create_power_monitor`.
For each capture:

- CSV path returned by the monitor backend (e.g. INA219 samples).
- Peer JSON summary saved next to the CSV containing the dictionary returned by
  `_summary_to_dict`:
  `timestamp_ns`, `suite`, `label`, `session_id`, `duration_s`, `samples`,
  `avg_current_a`, `avg_voltage_v`, `avg_power_w`, `energy_j`,
  `sample_rate_hz`, `csv_path`, `start_ns`, `end_ns` (plus `summary_json_path`).

### Copies of per-suite monitor data (`logs/auto/drone/<suite>`)
`Monitors.start()` writes suite-specific diagnostics:

- `perf_samples_<suite>.csv` — 1 Hz perf stat aggregation with fields described
  by `Monitors.PERF_FIELDS`.
- `pidstat_<suite>.txt` — live `pidstat -hlur` dump.
- `psutil_proc_<suite>.csv` — 1 Hz CPU%, RSS, thread count with columns
  `ts_unix_ns`, `cpu_percent`, `rss_bytes`, `num_threads`.
- `sys_telemetry_<suite>.csv` — 1 Hz thermal readouts (`ts_unix_ns`, `temp_c`,
  `freq_hz`, `throttled_hex`).

These sit under `logs/auto/drone/<suite>/` but the GCS combined workbook will
copy any CSVs it finds in the drone session directory as extra sheets.

## GCS Scheduler Artifacts (`logs/auto/gcs`)

### `summary.csv`
Generated by `write_summary()` when traffic mode is `blast` or `mavproxy`.
Columns taken from the `row` dict in `run_suite()`:

- Identification: `pass`, `suite`, `start_ns`, `end_ns`, `rekey_ms`.
- Packet counts: `sent`, `rcvd`, `pps`, `duration_s`.
- Bandwidth: `throughput_mbps`, `sent_mbps`, `delivered_ratio`,
  `goodput_mbps`, `wire_throughput_mbps_est`, `app_packet_bytes`,
  `wire_packet_bytes_est`, `goodput_ratio`.
- Latency: `rtt_avg_ms`, `rtt_max_ms`, `rtt_p50_ms`, `rtt_p95_ms`,
  `owd_p50_ms`, `owd_p95_ms`, `rtt_samples`, `owd_samples`, `sample_quality`.
- Loss: `loss_pct`, `loss_pct_wilson_low`, `loss_pct_wilson_high`.
- Proxy counters: `enc_out`, `enc_in`, `drops`, `rekeys_ok`, `rekeys_fail`.
- Power: `power_request_ok`, `power_capture_ok`, `power_error`,
  `power_avg_w`, `power_energy_j`, `power_samples`,
  `power_avg_current_a`, `power_avg_voltage_v`, `power_sample_rate_hz`,
  `power_duration_s`, `power_csv_path`, `power_summary_path`.

### `suites/<suite>/`
Per suite, the scheduler stores:

- `blaster_events.jsonl` – JSON line samples from the high-rate blaster
  (`{"event": "send"|"recv", "seq", "t_ns"}` plus occasional error events).
- `saturation_<rate>Mbps.jsonl` – When running saturation tests, each file holds
  the dictionary returned by `SaturationTester._run_rate()` per packet-rate.
- `gcs_status.json`, `gcs_summary.json` – proxy snapshots pulled after runs.

### Logs and status
Plain text logs (`gcs_*.log`) capture proxy stdout/stderr. The live status JSON
(`gcs_status.json`) mirrors the proxy status file. `gcs_summary.json` holds the
final proxy summary (`core.run_proxy --json-out`).

## Per-Suite Excel (`output/gcs/saturation_<suite>_<session_id>.xlsx`)
Created only in saturation mode. Contains a single `Saturation` sheet with the
records accumulated in `SaturationTester.records`. Column names match the keys
listed in `_run_rate()` (rates, throughput, latency, loss, sample quality, etc.).

## Combined Workbook (`output/gcs/<session_id>_combined.xlsx`)
Always written when `AUTO_GCS.export_combined_excel=True`.

Sheets:

- `run_info` – two rows (`generated_utc`, `session_id`), plus the resolved path
  to the drone session directory (or `not_found`).
- `gcs_summary` – same rows and columns as `logs/auto/gcs/summary.csv`.
- `saturation_overview` – aggregation returned by `SaturationTester.run()`:
  `suite`, baseline delay metrics, `saturation_point_mbps`, `stop_cause`,
  `confidence`, `search_mode`, `resolution_mbps`, `rekey_ms`, optional
  `excel_path` for the per-suite workbook.
- `saturation_samples` – concatenation of all saturation rate records (keys from
  `_run_rate()`). Empty if the session used `blast`/`mavproxy` traffic.
- `telemetry_samples` – snapshot of telemetry messages collected by
  `TelemetryCollector`. Entries include `session_id`, `kind`, `timestamp_ns`,
  and optional per-kind fields such as `cpu_percent`, `rss_bytes`, 
  `recv_timestamp_ns`, etc.
- `gcs_summary_csv` – direct import of `logs/auto/gcs/summary.csv` if present.
- Additional sheets – every CSV found in the drone session directory (e.g.
  `system_monitoring_<session>`, `packet_timing`, `psutil_proc_<suite>`,
  `sys_telemetry_<suite>`) is appended as its own worksheet using the base file
  name truncated to 31 characters.

## Control / Telemetry API Signals
The follower exposes a control socket on `DRONE_CONTROL_HOST:DRONE_CONTROL_PORT`
(default `0.0.0.0:48080`). `gcs_scheduler` uses commands such as `mark`,
`rekey_complete`, `schedule_mark`, `power_capture`, and `power_status` to
coordinate rekeys and monitoring. Telemetry published by the follower (`system`
metrics, UDP echo samples, power summaries, rekey markers, etc.) is consumed by
`TelemetryCollector` and saved into the combined workbook.

## Key Takeaways for Analysis

1. **Primary numerical summaries** live in `logs/auto/gcs/summary.csv` (per run)
   and the saturation records in the suite subdirectories.
2. **High-resolution drone metrics** live under `output/drone/<session_id>`;
   expect multiple CSV schemas in one session.
3. **Power data**: use the JSON summaries for metadata, then follow `csv_path`
   to pull the raw samples if deeper analysis is required.
4. **Telemetry** in the combined workbook is heterogeneous; the `kind` field
   (e.g. `system_sample`, `udp_echo_sample`, `power_summary`) distinguishes the
   payload shape.
5. **Session correlation** hinges on `session_id` and `suite` identifiers – both
   appear in CSV/JSON records and workbook sheets.

With this map we can design an analysis script that unifies per-suite summary
rows, saturation curves, drone-side monitoring, and telemetry within a single
reporting pipeline.
